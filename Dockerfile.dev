# Fix_Smart_CMS   - Development Docker Image
# Optimized for local development with hot reload

# ============================================================================
# Stage 1: Development base with all dependencies
# ============================================================================
FROM node:20-alpine AS development

# Set working directory
WORKDIR /app

# Install system dependencies for native modules and development tools
RUN apk add --no-cache \
    python3 \
    make \
    g++ \
    cairo-dev \
    jpeg-dev \
    pango-dev \
    musl-dev \
    giflib-dev \
    pixman-dev \
    pangomm-dev \
    libjpeg-turbo-dev \
    freetype-dev \
    curl \
    git \
    bash

# Copy package files
COPY package*.json ./

# Install all dependencies (including dev dependencies)
RUN npm ci

# Copy source code
COPY . .

# Generate Prisma client for development
RUN npx prisma generate --schema=prisma/schema.dev.prisma

# Create necessary directories
RUN mkdir -p uploads logs config/ssl && \
    chmod 755 uploads logs config

# Expose ports for development
EXPOSE 3000 4005

# Development command with hot reload
CMD ["npm", "run", "dev"]

# ============================================================================
# Build metadata
# ============================================================================
LABEL maintainer="Harihar Upadhyay <hariharupadhyay21@gnu.ac.in>"
LABEL version="1.0.3-dev"
LABEL description="Fix_Smart_CMS - Development Environment"
LABEL environment="development"